<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Notes application</title>
    <link href="css/main.css" rel="stylesheet">
    <link href="css/view_notes.css" rel="stylesheet">

</head>
<body>
    <div class="container">
        <header class="header">
            <div class="admin">
                <div class="notes_creation">
                    <input class="create_note" type="button" onclick="location.href='create_note.html';" value="Create new note">
                    <!--<button class="create_note " type="button">Create new note</button>-->
                </div>
                <div class="empty_admin_diff"></div>
                <div class="notes_styling">
                    <select class="styles" name="styles">
                        <option>Black white style</option>
                        <option>Random style</option>
                    </select>
                </div>
            </div>

            <div class="sorting_filtering">
                <div class="sorting">
                    <input class="sorting_button" type="button" value="Due date" id="sort_by_due_date">
                    <input class="sorting_button" type="button" value="Creation date" id="sort_by_creation_date">
                    <input class="sorting_button" type="button" value="Importance" id="sort_by_importance">
                </div>
                <div class="empty_div"></div>
                <div class="filtering">
                    <input class="filtering" type="button" value="Show finished" id="filter_finished">
                </div>
            </div>
        </header>
        <main class="content" id="main_content">
            <script>

            var notes = [
                {"id":1, "title":"CAS FE - Projekt im Github eintragen.", "due_date":"16.09.2016", "creation_date":"10.09.2016", "importance":1, "finished":true, "description":"HTML für die note App erstellen. CSS erstellen für die note app "},
                {"id":2, "title":"CAS FE - HTML Gerüst erstellen für die WireFrames inkl. CSS.", "due_date":"23.09.2016", "creation_date":"09.09.2016", "importance":3, "finished":true, "description":""},
                {"id":3, "title":"CAS FE - HTML Seite ausprogrammieren.", "due_date":"30.09.2016", "creation_date":"12.09.2016", "importance":5, "finished":false, "description":"HTML Seite ausprogrammieren: Anzeigen der Einträge / Filtern / Sortieren Daten in einer Variable abspeichern & Beispiel Daten erfassen. Handlebars verwenden für das Rendern der Einträge. "}
            ];

            // remove all child elements in the content section before adding new notes
            function removeContentElements() {
                var contentElement = document.getElementById("main_content");
                while (contentElement.firstChild) {
                    contentElement.removeChild(contentElement.firstChild);
                }
            }

            function renderNotes(notes) {
               removeContentElements();

                var df = document.createDocumentFragment();

                notes.forEach(function (note) {
                    var noteEntryElement = document.createElement("div");
                    noteEntryElement.className = "note_entry";
                    df.appendChild(noteEntryElement);
                    var noteElement = document.createElement("div");
                    noteElement.className = "note";
                    noteEntryElement.appendChild(noteElement);

                    var noteHeaderElement = document.createElement("header");
                    noteHeaderElement.className = "note_header";
                    noteElement.appendChild(noteHeaderElement);

                    var dueDateElement = document.createElement("div");
                    dueDateElement.className = "due_date";
                    dueDateElement.textContent = note.due_date;
                    noteHeaderElement.appendChild(dueDateElement);

                    var titleElement = document.createElement("div");
                    titleElement.className = "title";
                    titleElement.textContent = note.title;
                    noteHeaderElement.appendChild(titleElement);

                    var importanceElement = document.createElement("div");
                    importanceElement.className = "importance";
                    for (var i = 0; i < note.importance; ++i) {
                        var imgElement = document.createElement("img");
                        imgElement.className = "flash";
                        imgElement.src = "images/flash.svg";
                        imgElement.alt = "Flash icon";
                        importanceElement.appendChild(imgElement);
                    }
                    noteHeaderElement.appendChild(importanceElement);

                    var noteDetailsElement = document.createElement("div");
                    noteDetailsElement.className = "note_details";
                    noteElement.appendChild(noteDetailsElement);

                    var finishedElement = document.createElement("div");
                    finishedElement.className = "finished";
                    noteDetailsElement.appendChild(finishedElement);

                    var checkElement = document.createElement("input");
                    checkElement.type = "checkbox";
                    checkElement.checked = note.finished;
                    checkElement.disabled = true;
                    finishedElement.appendChild(checkElement);

                    if (note.description != "") {
                        var descriptionElement = document.createElement("div");
                        descriptionElement.className = "description";
                        descriptionElement.textContent = note.description;
                        noteDetailsElement.appendChild(descriptionElement);
                    }

                    var editElement = document.createElement("div");
                    editElement.className = "edit";
                    noteEntryElement.appendChild(editElement);

                    var editButtonElement = document.createElement("input");
                    editButtonElement.type = "button";
                    editButtonElement.value = "Edit";
                    editButtonElement.className = "edit_button";
                    editElement.appendChild(editButtonElement);

                });
                document.getElementById("main_content").appendChild(df);
            }

            function compareDueDates(note1, note2) {
                return note1.due_date > note2.due_date;
            }

            function compareImportance(note1, note2) {
                return note1.importance < note2.importance;
            }

            function compareCreationDate(note1, note2) {
                return note1.creation_date > note2.creation_date;
            }

            function clickDueDateSortEventHandler(event) {
                renderNotes(notes.sort(compareDueDates));
                console.log("sort by due date");
                console.log(notes);
            }

            function clickImportanceSortEventHandler(event) {
                renderNotes(notes.sort(compareImportance));
                console.log("sort by importance");
                console.log(notes);
            }

            function clickCreationDateSortEventHandler(event) {
                renderNotes(notes.sort(compareCreationDate))
                console.log("sort by creation date");
                console.log(notes);
            }

            function filterFinishedNotes(allNotes, notesToFilter) {
                var totalNotes = allNotes.length;
                console.log("Total all notes: " + totalNotes);

                var mainContent = document.getElementById("main_content");
                var notesDisplayed = mainContent.childElementCount;
                console.log("Number of notes displayed: " + notesDisplayed);

                if (totalNotes === notesDisplayed) {
                    console.log("remove finished notes");
                    allNotes.forEach(function (note) {
                            if (note.finished) {
                                console.log("removed note " + note.id);
                                delete notesToFilter[note.id];
                            }
                            else {
                                console.log("do not remove note " + note.id);
                            }
                        }
                    );
                    return notesToFilter;
                }

                return allNotes;

            }
            function clickFinishedFilterEventHandler(event) {
                var notesToFilter = JSON.parse(JSON.stringify(notes));
                var filteredNotes = filterFinishedNotes(notes, notesToFilter);
                renderNotes(filteredNotes);
            }

            window.onload = function () {
                console.log(notes);
                renderNotes(notes.sort(compareImportance));
                document.getElementById("sort_by_due_date").addEventListener("click", clickDueDateSortEventHandler);
                document.getElementById("sort_by_importance").addEventListener("click", clickImportanceSortEventHandler);
                document.getElementById("sort_by_creation_date").addEventListener("click", clickCreationDateSortEventHandler);
                document.getElementById("filter_finished").addEventListener("click", clickFinishedFilterEventHandler);
            }
            </script>
            <!--<div class="note_entry">
                <div class="note">
                    <header class="note_header">
                        <div class="due_date">
                            17.10.2016
                        </div>
                        <div class="title">
                            CAS Frontend Engineering - Selbstudium / Projektaufgabe erledigen

                        </div>
                        <div class="importance">
                            <img class="flash" src="images/flash.svg" alt="Flash icon">
                            <img class="flash" src="images/flash.svg" alt="Flash icon">
                            <img class="flash" src="images/flash.svg" alt="Flash icon">
                            <img class="flash" src="images/flash.svg" alt="Flash icon">
                            <img class="flash" src="images/flash.svg" alt="Flash icon">
                        </div>
                    </header>
                    <div class="note_details">
                        <div class="status">
                            <input type="checkbox">     Finished
                        </div>
                        <div class="description">
                            HTML für die note App erstellen. <br>
                            CSS erstellen für die note app [...]
                        </div>
                    </div>
                </div>
                <div class="edit">
                    <input class="edit_button" type="button" value="Edit">
                </div>
            </div>
            <div class="note_entry">
                <div class="note">
                    <header class="note_header">
                        <div class="due_date">
                            17.10.2016
                        </div>
                        <div class="title">
                            CAS Frontend Engineering - Selbstudium / Projektaufgabe erledigen

                        </div>
                        <div class="importance">
                            <img class="flash" src="images/flash.svg" alt="Flash icon">
                            <img class="flash" src="images/flash.svg" alt="Flash icon">
                            <img class="flash" src="images/flash.svg" alt="Flash icon">
                            <img class="flash" src="images/flash.svg" alt="Flash icon">
                            <img class="flash" src="images/flash.svg" alt="Flash icon">
                        </div>
                    </header>
                    <div class="note_details">
                        <div class="finished">
                            <input type="checkbox">     Finished
                        </div>
                        <div class="description">
                            HTML für die note App erstellen. <br>
                            CSS erstellen für die note app [...]
                        </div>
                    </div>
                </div>
                <div class="edit">
                    <input class="edit_button" type="button" value="Edit">
                </div>
            </div>-->
        </main>
    </div>
</body>
</html>